How to build and add libclang.
------------------------------

For iPhoneSimulator:

1) Download LLVM and Clang sources.
    svn co http://llvm.org/svn/llvm-project/llvm/trunk llvm
    cd llvm/tools
    svn co http://llvm.org/svn/llvm-project/cfe/trunk clang

2) Edit Makefile.rules.
    Replace -m64 at line 623 with -m32:
    TargetCommonOpts = -m64 -> TargetCommonOpts = -m32
    to force building 32-bit code even on 64-bit machines.
    
    Comment out line 575:
    LD.Flags += $(RPATH) -Wl,@executable_path/../lib
    to disable rpath.
    Apple GCC does not accept rpath unless target platform is OSX>10.5.
    Clang accepts it, but the simulator's SDKs don't have clang libraries.

3) Configure LLVM and Clang to build for i386, using the iPhoneSimulator SDK.
    ./configure --enable-optimized --disable-threads --prefix=/Users/Shared/Track/llvm-i386 CC="/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc" CFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2" CPPFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2" LDFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2"

4) Build LLVM and Clang for i386, using the iPhoneSimulator SDK.
    CC="/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc" CFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2" CPPFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2" LDFLAGS="-arch i386 -isysroot /Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator3.2.sdk -miphoneos-version-min=3.2" make VERBOSE=1 VERBOSE_TOOLS=1

5) Copy header and library into project directory.
    cp tools/clang/include/clang-c/Index.h ~/projectdir/
    cp Release+Asserts/lib/libclang.dylib ~/projectdir/

6) In your target build phases, add libclang.dylib to the "Copy Bundle Resources" phase.

7) In your target build settings, add "@loader_path/" to the "Runpath Search Paths" setting.